---
import ArrowIcon from '../ui/ArrowIcon.astro';
import Icon from '../ui/Icon.astro';

import pb from '../../lib/pb/pb.ts';
import type { ProjetsResponse } from '../../lib/pb/pocketbase-typegen';

let projets: ProjetsResponse[] = [];
try {
projets = await pb.collection('projets').getFullList<ProjetsResponse>({
sort: 'created',
fields: 'id,title,slug'
});
} catch (error) {
console.error('Erreur lors de la récupération des projets:', error);
}

const texts: Record<number, string> = {
  1: "JE VEUX CRÉER",
  4: "DES EXPÉRIENCES",
  9: "QUI",
  12: "DONNENT ENVIE",
  13: "DE RESTER",
  15: "DES EXPÉRIENCES",
  21: "QUI RACONTENT",
  22: "UNE HISTOIRE",
  25: "DES EXPÉRIENCES",
  26: "QUI SONT BELLES",
  27: "ET",
  35: "QUI FONCTIONNENT.",
};

const gridCells = Array(36).fill(null).map((_, index) => {
  const id = index + 1;
  return {
    id: id,
    text: texts[id] || null,
  };
});
---

<!-- FOOTER avec data-theme pour le thème sombre -->
<footer 
  class="h-screen w-full bg-transparent box-border p-4 lg:p-[26px_20px] font-['Poppins'] tracking-[-0.05em]"
  data-theme="dark"
  aria-label="Pied de page"
>
  <div class="relative h-full w-full rounded-3xl lg:rounded-[40px] bg-[#111111] grid place-items-center overflow-hidden">
    
    <!-- Grille de fond unifiée et responsive -->
    <div class="absolute inset-0 z-0 p-4 lg:p-[32px_52px] grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-12 grid-rows-4 sm:grid-rows-3" aria-hidden="true">
      {gridCells.map((cell, index) => {
        let visibilityClass = '';
        if (index >= 12 && index < 18) visibilityClass = 'hidden md:flex';
        else if (index >= 18 && index < 24) visibilityClass = 'hidden lg:flex';
        else if (index >= 24) visibilityClass = 'hidden xl:flex';
        else visibilityClass = 'flex';
        return (
          <div class={`group rounded-[20px] border border-[#222222] bg-[#111111] transition-colors duration-300 p-4 justify-start items-start hover:bg-[#222222] ${visibilityClass}`}>
            {cell.text && (
              <span class="hidden lg:block text-white uppercase text-sm transition-all duration-300 group-hover:translate-y-full">
                {cell.text}
              </span>
            )}
          </div>
        )
      })}
    </div>
    
    <!-- Îlots centraux -->
    <div class="relative z-10 flex flex-col items-center gap-4 w-full max-w-xs sm:max-w-md px-4 lg:px-0">
      
<nav 
  class="bg-white text-black rounded-3xl p-6 flex flex-col items-start gap-2 text-left w-full lg:w-80 transition-all duration-300 ease-in-out lg:hover:w-[330px]"
  aria-label="Navigation projets"
>
  {/* Titre Projets */}
  <a href="/projets" class="font-bold hover:underline transition-colors flex items-center gap-2 text-black">
    PROJETS <ArrowIcon variant="contact" class="w-3 h-3 text-black"/>
  </a>

  {/* Liste des projets */}
  <ul class="flex flex-col gap-1 w-full mb-2"> {/* J'ai ajouté mb-2 pour espacer un peu avant la ligne */}
    {projets.slice(0, 5).map((projet) => (
      <li class="w-full">
        <a 
          href={`/projets/${projet.slug}`} 
          class="text-black hover:text-gray-600 transition-colors block py-1"
        >
          {projet.title}
        </a>
      </li>
    ))}
  </ul>

  {/* --- AJOUT : SÉPARATEUR ET LIENS LÉGAUX --- */}
  
  {/* La barre horizontale */}
  <hr class="w-full border-black/10" />

  {/* Les liens alignés gauche/droite */}
  <div class="w-full flex justify-between items-center pt-1">
    <a 
      href="/mentions-legales" 
      class="text-xs sm:text-sm md:text-[13px] lg:text-[13px] text-gray-500 hover:text-black transition-colors whitespace-nowrap"
    >
      Mentions Légales
    </a>

    <a 
      href="/politique-de-confidentialite" 
      class="text-xs sm:text-sm md:text-[13px] lg:text-[13px] text-gray-500 hover:text-black transition-colors whitespace-nowrap"
    >
      Politique de Confidentialité
    </a>
  </div>

</nav>


      <div 
        class="bg-white text-black rounded-3xl p-4 flex flex-row items-center justify-center gap-4 text-left w-full lg:w-80 transition-all duration-300 ease-in-out lg:hover:w-[330px]"
        role="group"
        aria-label="Actions principales"
      >
        <a href="/contact" class="group button-contact flex items-center justify-center gap-2 py-2 px-4 rounded-full transition-all duration-300 hover:bg-black hover:text-white hover:px-6">
          <span class="whitespace-nowrap text-sm">Me contacter</span>
          <ArrowIcon variant="contact" class="w-3 h-3 text-black"/>
        </a>
        <a href="https://drive.google.com/file/d/1hGJjDHtJGs4xzaXUorJAHGboDvz0s5oA/view" target="_blank" rel="noopener noreferrer" class="group button-cv flex items-center justify-center gap-2 py-2 px-6 rounded-full transition-all duration-300 hover:bg-black hover:text-white hover:px-8">
          <span class="whitespace-nowrap text-sm">CV</span>
          <ArrowIcon variant="cv" class="w-3 h-3 text-black"/>
        </a>
      </div>
      
      <div 
        class="bg-white text-black rounded-3xl p-6 flex flex-row items-center justify-between gap-2 text-center w-full lg:w-80 transition-all duration-300 ease-in-out lg:hover:w-[330px]"
        role="contentinfo"
      >
        <Icon name="logofooter" class="h-12 w-auto text-black" aria-label="Logo"/>
        <nav class="flex items-center gap-2" aria-label="Réseaux sociaux">
          <a href="https://www.behance.net/lobaudry2" aria-label="Behance" class="transition-all duration-300 ease-in-out hover:-translate-y-1 delay-50">
            <Icon name="behance" class="h-7 w-7 lg:h-9 lg:w-9 text-black" hoverGradient="orange"/>
          </a>
          <a href="https://dribbble.com/leo-baudry" aria-label="Dribbble" class="transition-all duration-300 ease-in-out hover:-translate-y-1 delay-50">
            <Icon name="dribbble" class="h-7 w-7 lg:h-9 lg:w-9 text-black" hoverGradient="orange"/>
          </a>
          <a href="https://www.linkedin.com/in/l%C3%A9o-baudry-a00b88336/" aria-label="LinkedIn" class="transition-all duration-300 ease-in-out hover:-translate-y-1 delay-50">
            <Icon name="linkedin" class="h-7 w-7 lg:h-9 lg:w-9 text-black" hoverGradient="orange"/>
          </a>
          <a href="mailto:leobaudry@laposte.net" aria-label="Email" class="transition-all duration-300 ease-in-out hover:-translate-y-1 delay-50">
            <Icon name="mail" class="h-7 w-7 lg:h-9 lg:w-9 text-black" hoverGradient="green"/>
          </a>
        </nav>
      </div>
    </div>
  </div>
</footer>

<script>
  function initFooterObserver() {
    const header = document.querySelector('header');
    const footer = document.querySelector('footer[data-theme]');
    
    if (!header || !footer) return;

    const observerOptions = {
      root: null,
      rootMargin: '0px 0px -80% 0px',
      threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const theme = entry.target.getAttribute('data-theme');
          if (theme === 'dark') {
            header.classList.add('header-dark-theme');
          } else {
            header.classList.remove('header-dark-theme');
          }
        }
      });
    }, observerOptions);

    observer.observe(footer);
  }

  document.addEventListener('astro:page-load', initFooterObserver);
</script>
